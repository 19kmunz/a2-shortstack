<!doctype html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="css/style.css">
    <title>CS4241 Assignment 2</title>
    <meta charset="utf-8">
  </head>
  <body>
    <h1>Pet Gallery!</h1>
    <form action="">
      <label>Pet Name: <input name="name"></label>
      <label>Image Link: <input name="link"></label>
      <label>Pet Type:
        <select name="type">
          <option>Dog</option>
          <option>Cat</option>
          <option>Snake</option>
          <option>Bird</option>
          <option>Other</option>
        </select>
      </label>
      <button>Post That Pet!</button>
    </form>
    <div id="gallery">
      <img class="petTile" src="https://cdn.discordapp.com/attachments/428381972545404928/884522236025913374/image0.jpg" alt="Cute picture of Mordecai">
      <img class="petTile" src="https://cdn.discordapp.com/attachments/428381972545404928/884522261237882910/image0.jpg" alt="Cute picture of Pippi">
      <img class="petTile" src="https://i.imgur.com/Db4cRax.png" alt="Cute picture of Bubba">
    </div>
  </body>
  <script>

  const submit = function( e ) {
    // prevent default form action from being carried out
    e.preventDefault()

    const name = document.querySelector( 'input[name="name"]' ),
            link = document.querySelector( 'input[name="link"]' ),
            type = document.querySelector( 'select[name="type"]' ),
          json = { name: name.value, link: link.value, type: type.value },
          body = JSON.stringify( json )

    fetch( '/submit', {
      method:'POST',
      body 
    })
    .then( function( response ) {
      return response.json();
    })
    .then( function(json) {
      // do something with the reponse
      let galleryContents = '';
      for(let i = 0; i < json.length; i++){
          galleryContents += '<img class="petTile" src="' + json[i].link + '" alt="Cute picture of ' + json[i].name + '">'
      }
      const gallery = document.querySelector( '#gallery' )
      gallery.innerHTML = galleryContents;
    })

    return false
  }

  window.onload = function() {
    const button = document.querySelector( 'button' )
    button.onclick = submit
  }

  </script>
</html>
